package com.ruoyi.web.controller.termite;


import com.ruoyi.common.core.domain.AjaxResult;
import com.ruoyi.system.domain.BPatrolUnit;
import com.ruoyi.system.domain.BProject;
import com.ruoyi.system.mapper.BPatrolUnitMapper;
import com.ruoyi.system.mapper.CommonMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import static com.ruoyi.common.utils.PageUtils.startPage;

@RestController
@RequestMapping("/rest")
public class RestApiController {

    @Autowired
    CommonMapper  commonMapper;

    @Autowired
    private BPatrolUnitMapper bPatrolUnitMapper;

    /**
     * 根据用户获取分配给他的项目列表
     * @param userid
     * @return
     */
    @GetMapping("/getprojectlistbyuser")
    List<BProject> getprojectbyuserid(Long userid){

    return  commonMapper.getprojectlistbyuserid(userid);

    }

    /**
     * 首页统计信息，依据项目和用户查询，
     * @param userid   用户ID
     * @param projectid 项目id
     * @return
     */
    @GetMapping("/indexinfo")
    AjaxResult getindexinfo(Long userid,Long projectid){

        //分类统计
            int type1 = commonMapper.gettotalbytype(userid,1,projectid);
            int type2 = commonMapper.gettotalbytype(userid,2,projectid);
        //单元总数
            int unittotal =   commonMapper.gettotalunit(userid,projectid);

        //提交总数
          int datatotal  = commonMapper.getdatatotal(userid,projectid);
        //审核通过、未通过总数
          int passtotal =commonMapper.getdatatotalbystatus(userid,"3",projectid);
          int  backtotal = commonMapper.getdatatotalbystatus(userid,"4",projectid);

          Map<String,Object> result =new HashMap<>();

                result.put("type1",type1);
                result.put("type2",type2);
                result.put("unittotal",unittotal);
                result.put("datatotal",datatotal);
                result.put("passtotal",passtotal);
                result.put("backtotal",backtotal);


        return AjaxResult.success(result);
    }

    /**
     * 根据项目和用户，获取负责的每个工区的灾害信息量
     * @param projectid
     * @param userid
     * @return
     */
    @GetMapping("/unitlist")
    AjaxResult  getunitlist(Long projectid,Long userid){

     List<Map<String,Object>> res =   commonMapper.getprojecttotallist(projectid,userid);

            return  AjaxResult.success(res);
    }
    @GetMapping("/unitlist2")
    AjaxResult  getunitlist2(Long projectid,Long userid){

        List<Map<String,Object>> res =   commonMapper.getprojectunitllist(projectid,userid);

        return  AjaxResult.success(res);
    }

    @GetMapping("/unitlist3")
    AjaxResult  getunitlist3(Long projectid,Long userid){

        List<Map<String,Object>> res =   commonMapper.getprojectunitllist3(projectid,userid);

        return  AjaxResult.success(res);
    }



    @GetMapping("/getdatatotalbystatus")
    AjaxResult getdatatotalbystatus(Long projectid,Long userid){

        Map<String, Integer> res = commonMapper.getdatatotalbystatus2(projectid,userid);
         return AjaxResult.success(res);

    }

    //查询普查处数
    @GetMapping("/getPcdata")
    AjaxResult getPcdata( int projectid,int userid){
     int number  = commonMapper.getPcdata(projectid,userid);
     return  AjaxResult.success(number);

    }

    //查询已完成单元数
    @GetMapping("/getCompletedata")
    AjaxResult getCompletedata(int projectid,int userid){
        int number  = commonMapper.getCompletedata(projectid,userid);
        return  AjaxResult.success(number);

    }

    //查询全部单元数下的普查
    // 信息
    @GetMapping("/list")
    public AjaxResult getAllPuCha(int userId, int projectId)
    {
        startPage();
        List< Map<String, Object>> map = commonMapper.getprojecttotallistandUnitId(projectId, userId);

        //查找巡查表里没有的单元
        List< Map<String, Object>> map2 = commonMapper.getprojecttotallistandUnitIdSub(projectId, userId);
        map.addAll(map2);
        return AjaxResult.success(map);
    }


/*
    //查询单元下白蚁和鼠的数量
    @GetMapping("/getAllType")
    AjaxResult getAllType(int projectid,int userid){
  //      int number  = commonMapper.getAllType(projectid,userid);
  //      return  AjaxResult.success(number);
    }*/
}
